{% extends "base.html" %}

{% block content %}
<div style="padding: 2rem 5%;">
    <h1 data-i18n="official_panel">Official Control Panel</h1>

    <div style="display:grid; grid-template-columns: repeat(4, 1fr); gap:20px; margin-top:30px;">
        <div class="glass-card" style="text-align:center;">
            <h4 style="color:#666;" data-i18n="total_complaints">Total Complaints</h4>
            <h2 style="font-size:2.5rem; color:var(--primary);">{{ stats.total }}</h2>
        </div>
        <div class="glass-card" style="text-align:center; border-top:5px solid #f44336;">
            <h4 style="color:#666;" data-i18n="high_priority">High Priority</h4>
            <h2 style="font-size:2.5rem; color:#f44336;">{{ stats.high }}</h2>
        </div>
        <div class="glass-card" style="text-align:center;">
            <h4 style="color:#666;" data-i18n="pending">Pending</h4>
            <h2 style="font-size:2.5rem; color:#ff9800;">{{ stats.pending }}</h2>
        </div>
        <div class="glass-card" style="text-align:center; border-top:5px solid #4caf50;">
            <h4 style="color:#666;" data-i18n="resolved">Resolved</h4>
            <h2 style="font-size:2.5rem; color:#4caf50;">{{ stats.resolved }}</h2>
        </div>
    </div>

    <div class="glass-card" style="margin-top:30px;">
        <h3 data-i18n="complaint_mgmt">Complaint Management</h3>
        <div style="overflow-x: auto; margin-top:20px;">
            <table style="width:100%; border-collapse: collapse;">
                <thead>
                    <tr style="text-align:left; border-bottom:2px solid #eee;">
                        <th style="padding:10px;" data-i18n="id">ID</th>
                        <th data-i18n="citizen">Citizen</th>
                        <th data-i18n="sector">Sector</th>
                        <th data-i18n="pincode">Pincode</th>
                        <th data-i18n="priority">Priority</th>
                        <th data-i18n="status">Status</th>
                        <th data-i18n="cluster_id">Cluster ID</th>
                        <th data-i18n="action">Action</th>
                    </tr>
                </thead>
                <tbody>
                    {% for c in complaints %}
                    <tr style="border-bottom:1px solid #eee;">
                        <td style="padding:10px;">{{ c.complaint_id }}</td>
                        <td>{{ c.citizen_name }}</td>
                        <td>{{ c.sector }}</td>
                        <td>{{ c.pincode }}</td>
                        <td><span class="priority-badge {{ c.priority.lower() }}">{{ c.priority }}</span></td>
                        <td>
                            <select onchange="updateStatus('{{ c.complaint_id }}', this.value)"
                                style="padding:5px; border-radius:5px;">
                                <option value="Submitted" {% if c.status=='Submitted' %}selected{% endif %}>Submitted
                                </option>
                                <option value="Assigned" {% if c.status=='Assigned' %}selected{% endif %}>Assigned
                                </option>
                                <option value="In Progress" {% if c.status=='In Progress' %}selected{% endif %}>In
                                    Progress</option>
                                <option value="Resolved" {% if c.status=='Resolved' %}selected{% endif %}>Resolved
                                </option>
                            </select>
                        </td>
                        <td><code>{{ c.cluster_id }}</code></td>
                        <td><button class="btn" onclick="alert('Viewing: {{ c.description }}')"><i
                                    class="fas fa-eye"></i></button></td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<script>
    async function updateStatus(id, newStatus) {
        const res = await fetch('/api/update-status', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ id, status: newStatus })
        });
        const data = await res.json();
        if (data.success) {
            // alert("Status updated successfully");
        }
    }
</script>

<style>
    .priority-badge {
        padding: 3px 10px;
        border-radius: 10px;
        font-size: 0.8rem;
        font-weight: bold;
    }

    .high {
        background: #ffebee;
        color: #c62828;
    }

    .medium {
        background: #fff3e0;
        color: #ef6c00;
    }

    .low {
        background: #e8f5e9;
        color: #2e7d32;
    }
</style>
{% endblock %}