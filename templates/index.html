{% extends "base.html" %}

{% block content %}
<section class="hero">
    <div class="hero-content">
        <h1 data-i18n="hero_h1">Empowering Citizens, Improving Governance.</h1>
        <p data-i18n="hero_p">A transparent, AI-driven platform for voice-enabled grievance registration and welfare
            tracking.</p>
        <div style="display: flex; gap: 20px;">
            <a href="/dashboard" class="btn btn-primary btn-lg" data-i18n="btn_file">File a Grievance</a>
            <button onclick="toggleModal('track-modal')" class="btn btn-secondary btn-lg" data-i18n="btn_track">Track
                Complaint</button>
        </div>

        <div style="margin-top: 50px; padding: 20px; background: rgba(255,255,255,0.5); border-radius: 15px;">
            <h3 style="margin-bottom:15px;" data-i18n="how_works">How it works:</h3>
            <div class="steps-container">
                <div class="step-box">
                    <div class="step-number">1</div>
                    <div class="step-content" data-i18n="step1">Login to the portal</div>
                    <button onclick="readSingleStep('step1')" class="btn-icon"><i class="fas fa-volume-up"></i></button>
                </div>
                <div class="step-box">
                    <div class="step-number">2</div>
                    <div class="step-content" data-i18n="step2">Speak or type your grievance</div>
                    <button onclick="readSingleStep('step2')" class="btn-icon"><i class="fas fa-volume-up"></i></button>
                </div>
                <div class="step-box">
                    <div class="step-number">3</div>
                    <div class="step-content" data-i18n="step3">AI detects sector and priority automatically</div>
                    <button onclick="readSingleStep('step3')" class="btn-icon"><i class="fas fa-volume-up"></i></button>
                </div>
                <div class="step-box">
                    <div class="step-number">4</div>
                    <div class="step-content" data-i18n="step4">Receive your unique Complaint ID</div>
                    <button onclick="readSingleStep('step4')" class="btn-icon"><i class="fas fa-volume-up"></i></button>
                </div>
                <div class="step-box">
                    <div class="step-number">5</div>
                    <div class="step-content" data-i18n="step5">Monitor resolution progress in real-time</div>
                    <button onclick="readSingleStep('step5')" class="btn-icon"><i class="fas fa-volume-up"></i></button>
                </div>
            </div>

            <style>
                .steps-container {
                    display: flex;
                    flex-direction: column;
                    gap: 15px;
                }

                .step-box {
                    display: flex;
                    align-items: center;
                    background: white;
                    padding: 15px 20px;
                    border-radius: 50px;
                    /* Fully rounded/pill shape */
                    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
                    transition: 0.3s transform;
                    border-left: 5px solid transparent;
                }

                .step-box:hover {
                    transform: scale(1.02);
                    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
                }

                /* Distinct Colors for each step */
                /* Distinct Blue Shades for each step */
                .step-box:nth-child(1) {
                    border-left-color: #1a237e;
                }

                .step-box:nth-child(1) .step-number {
                    background: #1a237e;
                    box-shadow: 0 4px 10px rgba(26, 35, 126, 0.4);
                }

                .step-box:nth-child(1) .btn-icon {
                    color: #1a237e;
                }

                .step-box:nth-child(2) {
                    border-left-color: #283593;
                }

                .step-box:nth-child(2) .step-number {
                    background: #283593;
                    box-shadow: 0 4px 10px rgba(40, 53, 147, 0.4);
                }

                .step-box:nth-child(2) .btn-icon {
                    color: #283593;
                }

                .step-box:nth-child(3) {
                    border-left-color: #303f9f;
                }

                .step-box:nth-child(3) .step-number {
                    background: #303f9f;
                    box-shadow: 0 4px 10px rgba(48, 63, 159, 0.4);
                }

                .step-box:nth-child(3) .btn-icon {
                    color: #303f9f;
                }

                .step-box:nth-child(4) {
                    border-left-color: #3949ab;
                }

                .step-box:nth-child(4) .step-number {
                    background: #3949ab;
                    box-shadow: 0 4px 10px rgba(57, 73, 171, 0.4);
                }

                .step-box:nth-child(4) .btn-icon {
                    color: #3949ab;
                }

                .step-box:nth-child(5) {
                    border-left-color: #3f51b5;
                }

                .step-box:nth-child(5) .step-number {
                    background: #3f51b5;
                    color: white;
                    box-shadow: 0 4px 10px rgba(63, 81, 181, 0.4);
                }

                .step-box:nth-child(5) .btn-icon {
                    color: #3f51b5;
                }


                .step-number {
                    color: white;
                    width: 45px;
                    height: 45px;
                    border-radius: 50%;
                    display: flex;
                    justify-content: center;
                    align-items: center;
                    font-weight: 800;
                    margin-right: 20px;
                    font-size: 1.4rem;
                    flex-shrink: 0;
                }

                .step-content {
                    flex: 1;
                    font-weight: 700;
                    color: #1a237e;
                    /* Dark Blue Text */
                    font-size: 1.3rem;
                }

                /* Adjust for languages with taller scripts */
                :lang(ta) .step-content,
                :lang(ml) .step-content {
                    font-size: 1.1rem;
                    line-height: 1.4;
                }

                .btn-icon {
                    background: none;
                    border: none;
                    cursor: pointer;
                    font-size: 1.6rem;
                    padding: 5px;
                    transition: 0.2s;
                    opacity: 0.8;
                }

                .btn-icon:hover {
                    opacity: 1;
                    transform: scale(1.15) rotate(-10deg);
                }
            </style>
        </div>
    </div>
    <div class="hero-image">
        <!-- Using a placeholder for the lady illustration as I can't generate images here, 
             but I will use a nice CSS-based SVG or a public URL if available -->
        <img src="https://cdni.iconscout.com/illustration/premium/thumb/female-government-official-giving-speech-5683244-4729115.png"
            alt="Lady Official">
    </div>
</section>

<!-- Track Modal -->
<div id="track-modal" class="modal">
    <div class="modal-content">
        <div style="display:flex; justify-content:space-between; align-items:center;">
            <h2 data-i18n="track_modal_title">Track Your Grievance</h2>
            <span onclick="toggleModal('track-modal')" style="cursor:pointer; font-size:2rem;">&times;</span>
        </div>
        <div class="form-group" style="margin-top:20px;">
            <label data-i18n="enter_complaint_id">Enter Complaint ID</label>
            <input type="text" id="track-id" placeholder="e.g. CG12345678">
            <button onclick="trackGrievance()" class="btn btn-primary" style="margin-top:15px; width:100%;"
                data-i18n="track_status">Track
                Status</button>
        </div>
        <div id="track-result" style="margin-top:20px; display:none;">
            <div class="glass-card" style="padding:15px;">
                <h3 id="res-status"><span data-i18n="status">Status</span>: <span id="status-value">Submitted</span>
                </h3>
                <p id="res-details"></p>
                <div class="timeline" id="res-timeline">
                    <!-- Dynamic timeline here -->
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    async function trackGrievance() {
        const id = document.getElementById('track-id').value;
        const res = await fetch(`/api/track/${id}`);
        const data = await res.json();
        const resultDiv = document.getElementById('track-result');
        const detailsP = document.getElementById('res-details');
        const statusValue = document.getElementById('status-value');

        if (data.success) {
            resultDiv.style.display = 'block';

            // Get current language from main.js
            const lang = currentLang || 'en';
            const t = translations[lang] || translations['en'];

            // Update status with translation
            const statusKey = 'status_' + data.details.status.toLowerCase().replace(' ', '');
            statusValue.textContent = t[statusKey] || data.details.status;

            detailsP.innerHTML = `
                <strong>${t['citizen'] || 'Citizen'}:</strong> ${data.details.name}<br>
                <strong>${t['sector'] || 'Sector'}:</strong> ${t[data.details.sector.toLowerCase().replace(/\s+/g, '')] || data.details.sector}<br>
                <strong>${t['priority'] || 'Priority'}:</strong> <span class="priority-badge ${data.details.priority.toLowerCase()}">${data.details.priority}</span>
            `;

            // Build timeline logic with translations
            const status = data.details.status;
            const steps = ['Submitted', 'Assigned', 'In Progress', 'Resolved'];
            let timelineHtml = '';
            steps.forEach(step => {
                const isActive = steps.indexOf(step) <= steps.indexOf(status);
                const stepKey = 'status_' + step.toLowerCase().replace(' ', '');
                const translatedStep = t[stepKey] || step;
                timelineHtml += `
                    <div class="timeline-step">
                        <div class="step-indicator ${isActive ? 'active' : ''}"></div>
                        <div class="step-text">${translatedStep}</div>
                    </div>
                `;
            });
            document.getElementById('res-timeline').innerHTML = timelineHtml;
        } else {
            alert(data.message);
        }
    }
</script>

<style>
    .priority-badge {
        padding: 3px 10px;
        border-radius: 10px;
        font-size: 0.8rem;
        font-weight: bold;
    }

    .high {
        background: #ffebee;
        color: #c62828;
    }

    .medium {
        background: #fff3e0;
        color: #ef6c00;
    }

    .low {
        background: #e8f5e9;
        color: #2e7d32;
    }
</style>
{% endblock %}